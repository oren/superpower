require "colorize"

module Screen
	def self.clear
		print "\e[2J\e[1;1H"
	end

	def self.readkeypress
		STDIN.raw do |io|
			buffer = Bytes.new(3)
			bytes_read = io.read(buffer)
			input = String.new(buffer[0, bytes_read])

			case input
			when "\e[A", "w"
				:up
			when "\e[B", "s"
				:down
			when "\e[C", "d"
				:right
			when "\e[D", "a"
				:left
			when "\e"
				:escape
				return false
			when "\u{3}"
				:ctrl_c
				return false
			when "q", "Q"
				:q
				return false
			else
				:unknown
			end
		end

		true
	end
end

class Superpower
  VERSION = "0.1.0"
	@current_line = 3

	lines = [
		"Superpower Bot",
		"==============",
    "Introduction          [COMPLETED]",
	  "Find your superpowers            ",
		"==============",
		"HELP",
		"EXIT"
	]

	def draw
		Screen.clear

		lines.each_with_index do |line, index|
			if @current_line == index
				puts line.ljust(35).colorize.back(gray_background).fore(:light_gray)
			else
				puts line.ljust(35).colorize.back(blue_background).fore(:light_gray)
			end
		end
	end

	blue_background = Colorize::ColorRGB.new(0, 0, 139)
  gray_background = Colorize::ColorRGB.new(160, 160,160)

	Screen.clear

	text = "                                   \n"
	text += " Superpower Bot                    \n"
	text += " ==============                    \n"
	text += " Introduction          [COMPLETED] "
	text = text.colorize.back(background).fore(:light_gray)
	#puts text

	text = " Find your superpowers             "
	text = text.colorize.back(Colorize::ColorRGB.new(160, 160,160)).fore(background)
	#puts text

	text = " Your superpowers                  \n"
	text += " List of superpowers               \n"
	text += " ==============                    \n"
	text += " HELP                              \n"
	text += " EXIT                              \n"
	text += "                                   "
	text = text.colorize.back(background).fore(:light_gray)
	#puts text

	def run
		until false
			if Screen.readkeypress
				# insert_tile
				# draw
			else
				exit
			end
		end
	end

	# Hi, I am a bot that helps you find your superpowers. It will take you 30 mintues of playing.
  # I'll present you 30 stories and you'll pick the two that you think represent you. Let's get started!

	# TODO: read from db and highlight the completed task
end

Superpower.new.run
